FROM ubuntu AS builder

RUN apt update

RUN apt install -qy build-essential vim mercurial

# Download sudo
RUN hg clone https://www.sudo.ws/repos/sudo /usr/src/sudo

RUN cd /usr/src/sudo; hg up SUDO_1_8_26

RUN touch /etc/sudoers

RUN cd /usr/src/sudo; ./configure && make && make install

RUN mkdir -p /app

COPY . /app

WORKDIR /app

ENTRYPOINT ["/app/exploit_sudo", "testuser2"]

